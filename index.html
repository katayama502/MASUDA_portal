<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>益田市習い事ポータル | MASUDA Learning Hub</title>
  <meta name="description" content="益田市の学校別・大人向け習い事情報をまとめたポータルサイト。文化・スポーツ・アートまで幅広くご紹介。">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-content">
      <div class="logo">
        <span class="logo-mark">MASUDA</span>
        <span class="logo-text">Learning Hub</span>
      </div>
      <nav class="main-nav" aria-label="主要ナビゲーション">
        <ul>
          <li><a href="#schools">学校別</a></li>
          <li><a href="#adults">大人向け</a></li>
          <li><a href="#features">特集</a></li>
        </ul>
      </nav>
      <a class="cta-button" href="#schools">習い事を探す</a>
    </div>
  </header>

  <main>
    <section class="hero" role="banner">
      <div class="container hero-content">
        <div class="hero-copy">
          <p class="hero-tag">学校帰りに通える習い事がすぐ見つかる</p>
          <h1>益田市内の学校周辺で通える習い事データベース</h1>
          <p>
            小学生・中学生・高校生が通いやすいよう、各学校の周辺で開催されている習い事をまとめました。<br>
            対象学年や開催エリア、通っている学校のタグから希望の習い事を探してください。
          </p>
          <div class="hero-actions">
            <a class="primary" href="#schools">習い事を検索する</a>
            <a class="secondary" href="#features">特集を見る</a>
          </div>
        </div>
      </div>
      <div class="hero-gradient" aria-hidden="true"></div>
    </section>

    <section id="schools" class="section schools">
      <div class="container">
        <div class="section-heading">
          <h2>学校周辺の習い事一覧</h2>
          <p>島根県益田市にある学校の通学圏を中心に、放課後や週末に通える習い事をまとめました。対象学年や学校名タグで絞り込みができます。</p>
        </div>
        <div class="school-search" aria-label="益田市内の習い事検索">
          <div class="filters" role="region" aria-label="検索条件">
            <div class="search-box">
              <label for="school-search-input">習い事名・キーワード検索</label>
              <input id="school-search-input" type="search" placeholder="例: サッカー / 英語 / 益田中学校" autocomplete="off">
              <p class="help-text">習い事名・開催場所・対象学校タグで横断検索できます。</p>
            </div>
            <fieldset class="type-filter">
              <legend>対象学年で絞り込む</legend>
              <label>
                <input type="checkbox" name="school-type" value="elementary" checked>
                <span>小学生向け</span>
              </label>
              <label>
                <input type="checkbox" name="school-type" value="middle" checked>
                <span>中学生向け</span>
              </label>
              <label>
                <input type="checkbox" name="school-type" value="high" checked>
                <span>高校生向け</span>
              </label>
            </fieldset>
            <div class="tag-filter" role="region" aria-label="タグで絞り込む">
              <div class="tag-filter-heading">
                <span>タグ</span>
                <button type="button" class="clear-tags" id="clear-tag-filter" hidden>選択中のタグをクリア</button>
              </div>
              <div class="tag-list" id="tag-list" role="listbox" aria-multiselectable="true"></div>
              <p class="help-text">タグはすべて学校名です。複数選択すると、選んだ学校のどれかに対応する習い事を表示します。</p>
            </div>
          </div>
          <div class="results" role="region" aria-live="polite" aria-busy="false">
            <div class="result-summary" id="result-summary"></div>
            <div class="school-list" id="school-list" role="list"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="features" class="section features">
      <div class="container">
        <div class="section-heading">
          <h2>今月の特集</h2>
          <p>人気講座や話題の先生にフォーカスしたインタビュー記事。</p>
        </div>
        <div class="feature-grid">
          <article class="feature">
            <div class="feature-label">Teacher's Voice</div>
            <h3>益田市立高校 美術部 顧問 山本先生</h3>
            <p>「地域の文化財を活用したアート制作で、生徒の発想力がぐっと伸びました。」</p>
            <a class="more" href="#features">インタビューを読む</a>
          </article>
          <article class="feature">
            <div class="feature-label">Hot Lesson</div>
            <h3>島根県立大学 連携講座 デジタルクリエイティブ入門</h3>
            <p>大学生と高校生が一緒に学ぶ人気講座。3Dモデリングや動画制作を体験できる全6回の短期集中プログラム。</p>
            <a class="more" href="#features">日程を確認</a>
          </article>
          <article class="feature">
            <div class="feature-label">Report</div>
            <h3>石見神楽ジュニアチーム 全国大会レポート</h3>
            <p>全国大会で披露した演目「大蛇」の舞台裏と、メンバーの熱い想いを徹底レポート。</p>
            <a class="more" href="#features">レポートを読む</a>
          </article>
        </div>
      </div>
    </section>

    <section id="adults" class="section adults">
      <div class="container">
        <div class="section-heading">
          <h2>大人向け習い事</h2>
          <p>仕事帰りや週末に通える講座から、資格取得に役立つプログラムまで幅広く掲載。</p>
        </div>
        <div class="card-grid">
          <article class="card">
            <header>
              <p class="category">キャリア</p>
              <h3>益田市 DXリスキリング講座</h3>
            </header>
            <p>社会人のためのデジタル基礎講座。データ分析とノーコードツールを活用した業務改善を学びます。</p>
            <ul class="meta">
              <li><strong>期間:</strong> 5月開講 / 全8回</li>
              <li><strong>会場:</strong> 益田産業支援センター</li>
            </ul>
            <span class="more" aria-label="益田市 DXリスキリング講座の詳細は各教室へお問い合わせください">詳細は各教室へ</span>
          </article>
          <article class="card">
            <header>
              <p class="category">ウェルネス</p>
              <h3>石見ヨガスタジオ 夜クラス</h3>
            </header>
            <p>呼吸と瞑想を取り入れたリラックスプログラム。初心者でも安心して参加できる少人数制。</p>
            <ul class="meta">
              <li><strong>期間:</strong> 隔週水曜日 / 19:00-20:30</li>
              <li><strong>会場:</strong> 益田駅前スタジオ</li>
            </ul>
            <span class="more" aria-label="石見ヨガスタジオ 夜クラスの詳細は各教室へお問い合わせください">詳細は各教室へ</span>
          </article>
          <article class="card">
            <header>
              <p class="category">文化</p>
              <h3>石見神楽保存会 社会人講座</h3>
            </header>
            <p>伝統芸能の舞・囃子をゼロから学べる講座。衣装着付けや歴史講座などトータルでサポート。</p>
            <ul class="meta">
              <li><strong>期間:</strong> 通年募集</li>
              <li><strong>会場:</strong> 益田市立文化交流館</li>
            </ul>
            <span class="more" aria-label="石見神楽保存会 社会人講座の詳細は各教室へお問い合わせください">詳細は各教室へ</span>
          </article>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <div class="logo">
          <span class="logo-mark">MASUDA</span>
          <span class="logo-text">Learning Hub</span>
        </div>
        <p class="footer-copy">地域と学びをつなぐ益田市の情報プラットフォーム。</p>
      </div>
      <div>
        <h4>メニュー</h4>
        <ul>
          <li><a href="#schools">学校別</a></li>
          <li><a href="#adults">大人向け</a></li>
          <li><a href="#features">特集</a></li>
        </ul>
      </div>
      <div>
        <h4>SNS</h4>
        <ul class="sns">
          <li><a href="https://www.instagram.com/" target="_blank" rel="noopener">Instagram</a></li>
          <li><a href="https://www.facebook.com/" target="_blank" rel="noopener">Facebook</a></li>
          <li><a href="https://line.me/" target="_blank" rel="noopener">LINE公式</a></li>
        </ul>
      </div>
    </div>
    <p class="copyright">&copy; 2024 MASUDA Learning Hub</p>
  </footer>
  <script>
    const TYPE_LABELS = {
      elementary: '小学生向け',
      middle: '中学生向け',
      high: '高校生向け'
    };

    const TYPE_ORDER = {
      elementary: 0,
      middle: 1,
      high: 2
    };

    const SCHOOLS = [
      {
        name: '明光義塾 益田駅前教室',
        types: ['elementary', 'middle', 'high'],
        district: '駅前町（益田駅前ビル内）',
        address: '益田市駅前町 17-1 益田駅前ビル2F',
        managingBody: '明光義塾',
        notes: '個別指導専門の学習塾。学校別カリキュラムと定期テスト・受験対策に対応。',
        category: '学習塾・予備校',
        tags: ['駅前町', '益田駅', '個別指導']
      },
      {
        name: '渡辺塾',
        types: ['elementary', 'middle', 'high'],
        district: '益田市中心部',
        address: '益田市昭和町 本部教室ほか',
        managingBody: '渡辺塾',
        notes: '全教科対応の通い放題プランで自分のペースに合わせて学べる地域密着塾。',
        category: '学習塾・予備校',
        tags: ['昭和町', '通い放題', '全教科']
      },
      {
        name: '塾ナビ（益田市高校生向け塾一覧）',
        types: ['high'],
        district: 'オンライン特集',
        address: 'Web特集ページ',
        managingBody: '塾ナビ',
        notes: '益田市で高校生が通える学習塾・予備校を比較できるポータルサイト。',
        category: '学習塾・予備校',
        tags: ['高校生', '比較サイト']
      },
      {
        name: 'Puffin English School',
        types: ['elementary', 'middle', 'high'],
        district: '乙吉町',
        address: '益田市乙吉町 専用スタジオ',
        managingBody: 'Puffin English School',
        notes: '2才から大人まで対応する会話重視の少人数制英会話教室。',
        category: '英語・英会話',
        tags: ['乙吉町', '英会話', '少人数']
      },
      {
        name: 'ペッピーキッズクラブ 益田教室',
        types: ['elementary', 'middle'],
        district: '乙吉町',
        address: '益田市乙吉町 子ども英会話スタジオ',
        managingBody: 'イッティージャパン株式会社',
        notes: 'リズムとフォニックスを取り入れたこども英会話。幼児から中学生まで対応。',
        category: '英語・英会話',
        tags: ['乙吉町', 'こども英会話']
      },
      {
        name: 'ECCジュニア 久城教室',
        types: ['elementary', 'middle', 'high'],
        district: '久城町',
        address: '益田市久城町 個人宅教室',
        managingBody: 'ECCジュニア',
        notes: '英検・漢検対策コースもある地域密着型の英語教室。',
        category: '英語・英会話',
        tags: ['久城町', 'ECCジュニア', '検定対応']
      },
      {
        name: 'ECCジュニア（益田市内教室一覧）',
        types: ['elementary', 'middle', 'high'],
        district: 'オンライン特集',
        address: '公式サイト 教室検索',
        managingBody: 'ECCジュニア',
        notes: '益田市内のECCジュニア各教室をまとめて検索できる公式ページ。',
        category: '英語・英会話',
        tags: ['ECCジュニア', '比較サイト']
      },
      {
        name: 'こどもプログラミング教室 クリエット',
        types: ['elementary', 'middle'],
        district: '益田市内',
        address: '益田市内 会場は申込時に案内',
        managingBody: 'クリエット',
        notes: 'Scratchや電子工作で創造力を育む小中学生向けプログラミング教室。',
        category: 'プログラミング／ロボット',
        tags: ['プログラミング', 'Scratch']
      },
      {
        name: 'ヒューマンアカデミー こどもプログラミング 益田駅前教室',
        types: ['elementary', 'middle'],
        district: '駅前町（Eagaビル2F）',
        address: '益田市駅前町 35-2 Eagaビル2F',
        managingBody: 'ヒューマンアカデミー',
        notes: 'Scratch・マインクラフト・Pythonなど段階的に学べるカリキュラム。',
        category: 'プログラミング／ロボット',
        tags: ['駅前町', 'プログラミング', 'マイクラ']
      },
      {
        name: 'タミヤロボットスクール ツクロ益田教室',
        types: ['elementary', 'middle'],
        district: '常盤町',
        address: '益田市常盤町 体験スペース',
        managingBody: 'ツクロ益田',
        notes: 'タミヤのロボット教材で組み立てとプログラミングを学ぶ少人数クラス。',
        category: 'プログラミング／ロボット',
        tags: ['常盤町', 'ロボット', 'タミヤ']
      },
      {
        name: 'コエテコ（益田市プログラミング教室一覧）',
        types: ['elementary', 'middle'],
        district: 'オンライン特集',
        address: 'Web特集ページ',
        managingBody: 'コエテコ by GMO',
        notes: '益田市の子ども向けプログラミング・ロボット教室を比較できる情報サイト。',
        category: 'プログラミング／ロボット',
        tags: ['比較サイト', 'プログラミング']
      },
      {
        name: 'Enjoy Music Association',
        types: ['elementary', 'middle', 'high'],
        district: '市内複数拠点',
        address: '益田市内 各スタジオ（申込時案内）',
        managingBody: 'Enjoy Music Association',
        notes: 'ヤマハ有資格講師が在籍。ボーカル・ピアノなど幅広いコースを用意。',
        category: '音楽',
        tags: ['音楽', 'ボーカル', 'ピアノ']
      },
      {
        name: 'オリエント音楽教室センター 常盤教室',
        types: ['elementary', 'middle', 'high'],
        district: '常盤町',
        address: '益田市常盤町 ピアノ教室',
        managingBody: 'オリエント音楽教室センター',
        notes: '個別レッスンで基礎からコンクール対策まで対応するピアノ専門教室。',
        category: '音楽',
        tags: ['常盤町', 'ピアノ', '個別レッスン']
      },
      {
        name: 'ヤマハ音楽教室（益田・島根県内一覧）',
        types: ['elementary', 'middle', 'high'],
        district: 'オンライン特集',
        address: '公式サイト 教室検索',
        managingBody: 'ヤマハ音楽教室',
        notes: '益田市や島根県内のヤマハ音楽教室を横断的に調べられる公式ページ。',
        category: '音楽',
        tags: ['ヤマハ', '比較サイト']
      },
      {
        name: '太陽フィットネスクラブ 石見店 スイミングスクール',
        types: ['elementary', 'middle', 'high'],
        district: '駅前町',
        address: '益田市駅前町 25m×6コースの屋内プール',
        managingBody: '太陽フィットネスクラブ',
        notes: 'ベビーから選手育成まで対応。駅前で通いやすいスイミングスクール。',
        category: 'スポーツ / スイミング',
        tags: ['駅前町', 'スイミング']
      },
      {
        name: '益田スイミングクラブ',
        types: ['elementary', 'middle', 'high'],
        district: '益田市内',
        address: '益田市内 専用プール',
        managingBody: '益田スイミングクラブ',
        notes: '地域密着で技術と体力を育むスイミングクラブ。体験参加も受付。',
        category: 'スポーツ / スイミング',
        tags: ['スイミング', '市内クラブ']
      },
      {
        name: 'PSV益田',
        types: ['elementary', 'middle'],
        district: '益田市内各会場',
        address: '益田市内 グラウンド（U-8〜U-15対象）',
        managingBody: 'PSV益田サッカークラブ',
        notes: '育成課が学年別クラスを開講。月謝やスケジュールを公式サイトで公開。',
        category: 'スポーツ / サッカー',
        tags: ['サッカー', 'U-15', '育成']
      },
      {
        name: '島根県立サッカー場 サッカー教室',
        types: ['elementary', 'middle'],
        district: '乙吉町',
        address: '益田市乙吉町 島根県立サッカー場',
        managingBody: '島根県スポーツ振興財団',
        notes: '小・中学生対象の期別教室。プロコーチが基礎技術を指導。',
        category: 'スポーツ / サッカー',
        tags: ['乙吉町', 'サッカー教室']
      },
      {
        name: 'p-ground（益田市サッカーチーム検索）',
        types: ['elementary', 'middle', 'high'],
        district: 'オンライン特集',
        address: 'Web検索サービス',
        managingBody: 'p-ground',
        notes: '益田市のサッカーチームやスクールを検索できる情報データベース。',
        category: 'スポーツ / サッカー',
        tags: ['比較サイト', 'サッカー']
      },
      {
        name: '日本空手道糸洲会 拳志舘益田支部',
        types: ['elementary', 'middle'],
        district: '昭和町（市民体育館）',
        address: '益田市昭和町 市民体育館 剣道場',
        managingBody: '日本空手道糸洲会 拳志舘益田支部',
        notes: '小6〜中3を中心に指導。月謝無料で実費のみの空手教室。',
        category: 'スポーツ / 武道',
        tags: ['空手', '昭和町', '武道']
      },
      {
        name: '高津武道館',
        types: ['elementary', 'middle', 'high'],
        district: '高津町',
        address: '益田市高津町 高津武道館',
        managingBody: '高津武道館',
        notes: '剣道を中心に地域の武道活動を紹介。稽古情報を随時発信。',
        category: 'スポーツ / 武道',
        tags: ['高津町', '剣道', '武道']
      },
      {
        name: 'Sunbeams キッズダンスチーム',
        types: ['elementary', 'middle'],
        district: '益田市内',
        address: '益田市内 練習スタジオ',
        managingBody: 'Sunbeams',
        notes: '幼児から参加できるキッズダンスチーム。地域イベントへの出演も多数。',
        category: 'ダンス',
        tags: ['ダンス', 'キッズ', 'イベント出演']
      },
      {
        name: 'MYSブライトネス ダンススタジオ',
        types: ['elementary', 'middle', 'high'],
        district: '益田・浜田エリア',
        address: '益田市内 提携スタジオ（詳細は公式SNS）',
        managingBody: 'MYSブライトネス',
        notes: 'ジャズ・K-POPなど多彩なジャンルを学べるダンススタジオ。',
        category: 'ダンス',
        tags: ['ダンス', 'K-POP', '浜田エリア']
      },
      {
        name: '習研 岡野書道教室',
        types: ['elementary', 'middle', 'high'],
        district: '駅前町',
        address: '益田市駅前町 書道教室',
        managingBody: '習研 岡野書道教室',
        notes: '月3回開催。体験レッスンも受付する少人数制の書道教室。',
        category: '書道・そろばん',
        tags: ['書道', '駅前町', '少人数']
      },
      {
        name: '佐々木習字教室',
        types: ['elementary', 'middle', 'high'],
        district: '東町',
        address: '益田市東町 書道教室',
        managingBody: '佐々木習字教室',
        notes: '幼児から一般まで学べる書道教室。月謝2,500円で継続しやすい。',
        category: '書道・そろばん',
        tags: ['書道', '東町', '月謝2500円']
      },
      {
        name: '公文式（益田市内教室）',
        types: ['elementary', 'middle', 'high'],
        district: '乙吉・久城・高津ほか',
        address: '益田市内各教室（乙吉・久城・高津・本町・三宅町・横田）',
        managingBody: '公文教育研究会',
        notes: '算数・英語・国語の個別学習。学校帰りに通いやすい複数教室を展開。',
        category: '書道・そろばん',
        tags: ['公文式', '個別学習', '複数教室']
      },
      {
        name: '福原そろばん教室 ほか市内そろばん教室',
        types: ['elementary', 'middle'],
        district: '染羽町 ほか',
        address: '益田市染羽町（福原そろばん）ほか 増野・西本・岩本教室あり',
        managingBody: '益田市そろばん教室ネットワーク',
        notes: '基礎から珠算・暗算を学べるそろばん教室。市内複数拠点を掲載。',
        category: '書道・そろばん',
        tags: ['そろばん', '染羽町', '珠算']
      },
      {
        name: '学年別おすすめ：小学生',
        types: ['elementary'],
        district: 'ガイド記事',
        address: 'MASUDA Learning Hub 編集部',
        managingBody: 'MASUDA Learning Hub',
        notes: 'ECCジュニアやPeppy、クリエット、ヒューマンアカデミー、タミヤロボットスクール、EMA音楽、スイミング、PSV、書道、そろばん、公文などをチェック。',
        category: '学年別ガイド',
        tags: ['ガイド', '小学生向け']
      },
      {
        name: '学年別おすすめ：中学生',
        types: ['middle'],
        district: 'ガイド記事',
        address: 'MASUDA Learning Hub 編集部',
        managingBody: 'MASUDA Learning Hub',
        notes: '明光義塾や渡辺塾、公文、英会話継続、PSV（U-15）、スイミング、書道などを比較。',
        category: '学年別ガイド',
        tags: ['ガイド', '中学生向け']
      },
      {
        name: '学年別おすすめ：高校生',
        types: ['high'],
        district: 'ガイド記事',
        address: 'MASUDA Learning Hub 編集部',
        managingBody: 'MASUDA Learning Hub',
        notes: '明光義塾や渡辺塾、公文、映像授業系予備校、上級英会話、音楽専門レッスンなどを紹介。',
        category: '学年別ガイド',
        tags: ['ガイド', '高校生向け']
      }
    ];
    function getSchoolTypes(school) {
      if (Array.isArray(school.types) && school.types.length > 0) {
        return school.types;
      }
      if (school.type) {
        return [school.type];
      }
      return [];
    }

    function getPrimaryTypeOrder(school) {
      const schoolTypes = getSchoolTypes(school);
      if (schoolTypes.length === 0) return 99;
      return Math.min(
        ...schoolTypes.map((type) => {
          const order = TYPE_ORDER[type];
          return typeof order === 'number' ? order : 99;
        })
      );
    }

    const typeKeys = Object.keys(TYPE_ORDER);

    const state = {
      types: new Set(typeKeys),
      tags: new Set(),
      term: ''
    };

    const searchInput = document.getElementById('school-search-input');
    const typeCheckboxes = document.querySelectorAll('input[name="school-type"]');
    const tagList = document.getElementById('tag-list');
    const schoolList = document.getElementById('school-list');
    const resultSummary = document.getElementById('result-summary');
    const clearTagsButton = document.getElementById('clear-tag-filter');
    const resultsRegion = document.querySelector('.results');

    const allTags = Array.from(new Set(SCHOOLS.flatMap((school) => school.tags ?? []))).sort((a, b) =>
      a.localeCompare(b, 'ja')
    );

    const tagButtons = new Map();

    allTags.forEach((tag) => {
      const button = document.createElement('button');
      button.type = 'button';
      button.className = 'tag-chip';
      button.textContent = tag;
      button.setAttribute('role', 'option');
      button.setAttribute('aria-pressed', 'false');
      button.dataset.tag = tag;
      button.addEventListener('click', () => {
        const isSelected = state.tags.has(tag);
        if (isSelected) {
          state.tags.delete(tag);
        } else {
          state.tags.add(tag);
        }
        button.classList.toggle('active', !isSelected);
        button.setAttribute('aria-pressed', (!isSelected).toString());
        clearTagsButton.hidden = state.tags.size === 0;
        render();
      });
      tagButtons.set(tag, button);
      tagList.appendChild(button);
    });

    clearTagsButton.addEventListener('click', () => {
      state.tags.clear();
      tagButtons.forEach((button) => {
        button.classList.remove('active');
        button.setAttribute('aria-pressed', 'false');
      });
      clearTagsButton.hidden = true;
      render();
    });

    searchInput.addEventListener('input', (event) => {
      state.term = event.target.value.trim();
      render();
    });

    typeCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener('change', () => {
        const { value, checked } = checkbox;
        if (checked) {
          state.types.add(value);
        } else {
          state.types.delete(value);
          if (state.types.size === 0) {
            state.types.add(value);
            checkbox.checked = true;
            return;
          }
        }
        render();
      });
    });

    function normalizeText(value) {
      return value.toString().toLowerCase().normalize('NFKC');
    }

    function filterSchools() {
      const normalizedTerm = normalizeText(state.term);
      return SCHOOLS.filter((school) => {
        const schoolTypes = getSchoolTypes(school);
        if (schoolTypes.length === 0) return true;
        return schoolTypes.some((type) => state.types.has(type));
      })
        .filter((school) => {
          if (!normalizedTerm) return true;
          const keywords = [
            school.name,
            school.district,
            school.address,
            school.managingBody,
            school.notes,
            school.category,
            ...(school.keywords ?? []),
            ...(school.tags ?? [])
          ].join(' ');
          return normalizeText(keywords).includes(normalizedTerm);
        })
        .filter((school) => {
          if (state.tags.size === 0) return true;
          const tags = school.tags ?? [];
          return Array.from(state.tags).some((tag) => tags.includes(tag));
        })
        .sort((a, b) => {
          const typeDiff = getPrimaryTypeOrder(a) - getPrimaryTypeOrder(b);
          if (typeDiff !== 0) return typeDiff;
          return a.name.localeCompare(b.name, 'ja');
        });
    }

    function appendDetail(list, term, value) {
      if (!value) return;
      const dt = document.createElement('dt');
      dt.textContent = term;
      const dd = document.createElement('dd');
      dd.textContent = value;
      list.append(dt, dd);
    }
    function createSchoolCard(school) {
      const article = document.createElement('article');
      article.className = 'school-card';
      article.setAttribute('role', 'listitem');

      const header = document.createElement('header');
      const schoolTypes = getSchoolTypes(school).sort(
        (a, b) => (TYPE_ORDER[a] ?? 99) - (TYPE_ORDER[b] ?? 99)
      );

      if (schoolTypes.length > 0) {
        const typeGroup = document.createElement('div');
        typeGroup.className = 'school-type-group';
        schoolTypes.forEach((type) => {
          const typeLabel = document.createElement('span');
          typeLabel.className = 'school-type';
          typeLabel.textContent = TYPE_LABELS[type] ?? '習い事';
          typeGroup.appendChild(typeLabel);
        });
        header.appendChild(typeGroup);
      }

      const name = document.createElement('h3');
      name.textContent = school.name;
      header.appendChild(name);

      if (school.category) {
        const category = document.createElement('p');
        category.className = 'school-category';
        category.textContent = school.category;
        header.appendChild(category);
      }

      if (school.district) {
        const area = document.createElement('p');
        area.className = 'school-area';
        area.textContent = school.district;
        header.appendChild(area);
      }

      article.appendChild(header);

      const detail = document.createElement('dl');
      detail.className = 'school-detail';
      appendDetail(detail, '所在地', school.address);
      appendDetail(detail, '主催', school.managingBody);
      article.appendChild(detail);

      if (school.notes) {
        const notes = document.createElement('p');
        notes.className = 'school-notes';
        notes.textContent = school.notes;
        article.appendChild(notes);
      }

      if (school.tags && school.tags.length > 0) {
        const tags = document.createElement('ul');
        tags.className = 'school-tags';
        school.tags.forEach((tag) => {
          const item = document.createElement('li');
          item.textContent = tag;
          tags.appendChild(item);
        });
        article.appendChild(tags);
      }

      return article;
    }

    function render() {
      resultsRegion.setAttribute('aria-busy', 'true');
      const results = filterSchools();
      schoolList.replaceChildren();

      if (results.length === 0) {
        const empty = document.createElement('p');
        empty.className = 'empty-state';
        empty.textContent = '該当する習い事が見つかりませんでした。検索条件を見直してください。';
        schoolList.appendChild(empty);
      } else {
        results.forEach((school) => {
          schoolList.appendChild(createSchoolCard(school));
        });
      }

      const typeCounts = results.reduce((acc, school) => {
        getSchoolTypes(school).forEach((type) => {
          if (!state.types.has(type)) return;
          acc[type] = (acc[type] ?? 0) + 1;
        });
        return acc;
      }, {});

      const breakdown = typeKeys
        .map((type) => {
          const count = typeCounts[type] ?? 0;
          return count > 0 ? `${TYPE_LABELS[type]} ${count}件` : null;
        })
        .filter(Boolean)
        .join(' / ');

      resultSummary.innerHTML = `<strong>${results.length}</strong> 件の習い事を表示中${
        breakdown ? `<br><span class="result-breakdown">${breakdown}</span>` : ''
      }`;

      resultsRegion.setAttribute('aria-busy', 'false');
    }

    render();
  </script>
</body>
</html>
